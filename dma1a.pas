                                   Disk Editor
                                       8.0
                          Freitag, Mai 30, 1997 11:10am

                          *****************************
                          2,112,768 Sektoren ausgew„hlt
                          *****************************

00000000: 7B 56 65 72 73 69 6F 6E  - 20 31 2E 30 20 41 6C 6C   {Version 1.0 All
00000010: 65 73 20 67 65 68 74 21  - 21 21 7D 0D 0A 75 73 65   es geht!!!}..use
00000020: 73 20 63 72 74 2C 64 6F  - 73 3B 0D 0A 54 59 50 45   s crt,dos;..TYPE
00000030: 20 44 4D 41 61 72 72 61  - 79 20 3D 20 61 72 72 61    DMAarray = arra
00000040: 79 5B 30 2E 2E 37 5D 20  - 6F 66 20 62 79 74 65 3B   y[0..7] of byte;
00000050: 0D 0A 63 6F 6E 73 74 20  - 69 6E 74 65 72 3D 35 3B   ..const inter=5;
00000060: 0D 0A 64 6D 61 3D 31 3B  - 0D 0A 20 44 4D 41 5F 41   ..dma=1;.. DMA_A
00000070: 64 72 65 73 73 20 20 20  - 20 20 20 20 20 20 20 20   dress           
00000080: 20 3A 20 44 4D 41 61 72  - 72 61 79 20 3D 20 28 24    : DMAarray = ($
00000090: 30 30 2C 24 30 32 2C 24  - 30 34 2C 24 30 36 2C 24   00,$02,$04,$06,$
000000A0: 43 30 2C 24 43 34 2C 24  - 43 38 2C 24 43 43 29 3B   C0,$C4,$C8,$CC);
000000B0: 0D 0A 20 44 4D 41 5F 43  - 6F 75 6E 74 20 20 20 20   .. DMA_Count    
000000C0: 20 20 20 20 20 20 20 20  - 20 3A 20 44 4D 41 61 72            : DMAar
000000D0: 72 61 79 20 3D 20 28 24  - 30 31 2C 24 30 33 2C 24   ray = ($01,$03,$
000000E0: 30 35 2C 24 30 37 2C 24  - 43 32 2C 24 43 36 2C 24   05,$07,$C2,$C6,$
000000F0: 43 41 2C 24 43 45 29 3B  - 0D 0A 20 44 4D 41 52 65   CA,$CE);.. DMARe
00000100: 61 64 5F 73 74 61 74 75  - 73 5F 52 65 67 20 20 20   ad_status_Reg   
00000110: 20 3A 20 44 4D 41 61 72  - 72 61 79 20 3D 20 28 24    : DMAarray = ($
00000120: 30 38 2C 24 30 38 2C 24  - 30 38 2C 24 30 38 2C 24   08,$08,$08,$08,$
00000130: 44 30 2C 24 44 30 2C 24  - 44 30 2C 24 44 30 29 3B   D0,$D0,$D0,$D0);
00000140: 0D 0A 20 44 4D 41 57 72  - 69 74 65 5F 73 74 61 74   .. DMAWrite_stat
00000150: 75 73 5F 52 65 67 20 20  - 20 3A 20 44 4D 41 61 72   us_Reg   : DMAar
00000160: 72 61 79 20 3D 20 28 24  - 30 38 2C 24 30 38 2C 24   ray = ($08,$08,$
00000170: 30 38 2C 24 30 38 2C 24  - 44 30 2C 24 44 30 2C 24   08,$08,$D0,$D0,$
00000180: 44 30 2C 24 44 30 29 3B  - 0D 0A 20 44 4D 41 57 72   D0,$D0);.. DMAWr
00000190: 69 74 65 5F 72 65 71 75  - 5F 52 65 67 20 20 20 20   ite_requ_Reg    
000001A0: 20 3A 20 44 4D 41 61 72  - 72 61 79 20 3D 20 28 24    : DMAarray = ($
000001B0: 30 39 2C 24 30 39 2C 24  - 30 39 2C 24 30 39 2C 24   09,$09,$09,$09,$
000001C0: 44 32 2C 24 44 32 2C 24  - 44 32 2C 24 44 32 29 3B   D2,$D2,$D2,$D2);
000001D0: 0D 0A 20 44 4D 41 57 72  - 5F 73 69 6E 67 6C 65 5F   .. DMAWr_single_
000001E0: 6D 61 73 6B 5F 52 65 67  - 20 3A 20 44 4D 41 61 72   mask_Reg : DMAar
000001F0: 72 61 79 20 3D 20 28 24  - 30 41 2C 24 30 41 2C 24   ray = ($0A,$0A,$
00000200: 30 41 2C 24 30 41 2C 24  - 44 34 2C 24 44 34 2C 24   0A,$0A,$D4,$D4,$
00000210: 44 34 2C 24 44 34 29 3B  - 0D 0A 20 44 4D 41 57 72   D4,$D4);.. DMAWr
00000220: 5F 6D 6F 64 65 5F 52 65  - 67 20 20 20 20 20 20 20   _mode_Reg       
00000230: 20 3A 20 44 4D 41 61 72  - 72 61 79 20 3D 20 28 24    : DMAarray = ($
00000240: 30 42 2C 24 30 42 2C 24  - 30 42 2C 24 30 42 2C 24   0B,$0B,$0B,$0B,$
00000250: 44 36 2C 24 44 36 2C 24  - 44 36 2C 24 44 36 29 3B   D6,$D6,$D6,$D6);
00000260: 0D 0A 20 44 4D 41 43 6C  - 65 61 72 5F 46 6C 69 70   .. DMAClear_Flip
00000270: 66 6C 6F 70 20 20 20 20  - 20 3A 20 44 4D 41 61 72   flop     : DMAar
00000280: 72 61 79 20 3D 20 28 24  - 30 43 2C 24 30 43 2C 24   ray = ($0C,$0C,$
00000290: 30 43 2C 24 30 43 2C 24  - 44 38 2C 24 44 38 2C 24   0C,$0C,$D8,$D8,$
000002A0: 44 38 2C 24 44 38 29 3B  - 0D 0A 20 44 4D 41 52 65   D8,$D8);.. DMARe
000002B0: 61 64 5F 54 65 6D 70 5F  - 52 65 67 20 20 20 20 20   ad_Temp_Reg     
000002C0: 20 3A 20 44 4D 41 61 72  - 72 61 79 20 3D 20 28 24    : DMAarray = ($
000002D0: 30 44 2C 24 30 44 2C 24  - 30 44 2C 24 30 44 2C 24   0D,$0D,$0D,$0D,$
000002E0: 44 41 2C 24 44 41 2C 24  - 44 41 2C 24 44 41 29 3B   DA,$DA,$DA,$DA);
000002F0: 0D 0A 20 44 4D 41 4D 61  - 73 74 65 72 5F 43 6C 65   .. DMAMaster_Cle
00000300: 61 72 20 20 20 20 20 20  - 20 3A 20 44 4D 41 61 72   ar       : DMAar
00000310: 72 61 79 20 3D 20 28 24  - 30 44 2C 24 30 44 2C 24   ray = ($0D,$0D,$
00000320: 30 44 2C 24 30 44 2C 24  - 44 41 2C 24 44 41 2C 24   0D,$0D,$DA,$DA,$
00000330: 44 41 2C 24 44 41 29 3B  - 0D 0A 20 44 4D 41 5F 43   DA,$DA);.. DMA_C
00000340: 6C 65 61 72 5F 4D 61 73  - 6B 5F 52 65 67 20 20 20   lear_Mask_Reg   
00000350: 20 3A 20 44 4D 41 61 72  - 72 61 79 20 3D 20 28 24    : DMAarray = ($
00000360: 30 45 2C 24 30 45 2C 24  - 30 45 2C 24 30 45 2C 24   0E,$0E,$0E,$0E,$
00000370: 44 43 2C 24 44 43 2C 24  - 44 43 2C 24 44 43 29 3B   DC,$DC,$DC,$DC);
00000380: 0D 0A 20 44 4D 41 5F 57  - 72 5F 41 6C 6C 5F 4D 61   .. DMA_Wr_All_Ma
00000390: 73 6B 5F 52 65 67 20 20  - 20 3A 20 44 4D 41 61 72   sk_Reg   : DMAar
000003A0: 72 61 79 20 3D 20 28 24  - 30 46 2C 24 30 46 2C 24   ray = ($0F,$0F,$
000003B0: 30 46 2C 24 30 46 2C 24  - 44 45 2C 24 44 45 2C 24   0F,$0F,$DE,$DE,$
000003C0: 44 45 2C 24 44 45 29 3B  - 0D 0A 20 44 4D 41 5F 4C   DE,$DE);.. DMA_L
000003D0: 6F 77 65 72 5F 50 61 67  - 65 20 20 20 20 20 20 20   ower_Page       
000003E0: 20 3A 20 44 4D 41 61 72  - 72 61 79 20 3D 20 28 24    : DMAarray = ($
000003F0: 38 37 2C 24 38 33 2C 24  - 38 31 2C 24 38 32 2C 24   87,$83,$81,$82,$
00000400: 30 30 2C 24 38 42 2C 24  - 38 39 2C 24 38 41 29 3B   00,$8B,$89,$8A);
00000410: 0D 0A 20 44 4D 41 5F 48  - 69 67 68 65 72 5F 50 61   .. DMA_Higher_Pa
00000420: 67 65 20 20 20 20 20 20  - 20 3A 20 41 72 72 61 79   ge       : Array
00000430: 5B 30 2E 2E 37 5D 20 6F  - 66 20 77 6F 72 64 0D 0A   [0..7] of word..
00000440: 20 20 20 20 20 20 20 20  - 20 20 20 20 20 20 20 20                   
00000450: 20 20 20 20 20 20 20 20  - 20 20 20 20 3D 20 28 24               = ($
00000460: 34 38 37 2C 24 34 38 33  - 2C 24 34 38 31 2C 24 34   487,$483,$481,$4
00000470: 38 32 2C 24 30 2C 24 34  - 38 42 2C 24 34 38 39 2C   82,$0,$48B,$489,
00000480: 24 34 38 41 29 3B 0D 0A  - 74 79 70 65 20 70 72 6F   $48A);..type pro
00000490: 63 3D 70 72 6F 63 65 64  - 75 72 65 3B 0D 0A 70 74   c=procedure;..pt
000004A0: 3D 72 65 63 6F 72 64 0D  - 0A 6F 66 73 2C 73 65 67   =record..ofs,seg
000004B0: 6D 3A 77 6F 72 64 3B 0D  - 0A 65 6E 64 3B 0D 0A 76   m:word;..end;..v
000004C0: 61 72 20 74 65 6D 70 2C  - 74 65 6D 70 62 75 66 2C   ar temp,tempbuf,
000004D0: 6F 6C 64 69 6E 74 76 65  - 63 2C 62 6C 6B 31 2C 62   oldintvec,blk1,b
000004E0: 6C 6B 32 3A 70 6F 69 6E  - 74 65 72 3B 73 65 67 6D   lk2:pointer;segm
000004F0: 65 6E 2C 6F 66 66 73 65  - 2C 62 6C 32 2C 62 6C 6F   en,offse,bl2,blo
00000500: 63 6B 67 72 3A 77 6F 72  - 64 3B 66 72 65 71 75 65   ckgr:word;freque
00000510: 6E 7A 2C 67 72 6F 73 73  - 2C 70 68 79 73 70 6F 73   nz,gross,physpos
00000520: 3A 6C 6F 6E 67 69 6E 74  - 3B 0D 0A 62 6C 6F 63 6B   :longint;..block
00000530: 3A 62 6F 6F 6C 65 61 6E  - 3B 66 3A 66 69 6C 65 3B   :boolean;f:file;
00000540: 0D 0A 6F 6C 64 70 72 6F  - 63 3A 70 72 6F 63 20 61   ..oldproc:proc a
00000550: 62 73 6F 6C 75 74 65 20  - 6F 6C 64 69 6E 74 76 65   bsolute oldintve
00000560: 63 3B 0D 0A 4F 6C 64 65  - 78 69 74 3A 70 6F 69 6E   c;..Oldexit:poin
00000570: 74 65 72 3B 0D 0A 6C 61  - 73 74 32 2C 6C 61 73 74   ter;..last2,last
00000580: 2C 72 65 61 64 31 2C 72  - 65 61 64 32 3A 62 6F 6F   ,read1,read2:boo
00000590: 6C 65 61 6E 3B 0D 0A 7A  - 61 68 6C 65 72 2C 70 6E   lean;..zahler,pn
000005A0: 3A 77 6F 72 64 3B 0D 0A  - 44 49 52 3A 53 45 41 52   :word;..DIR:SEAR
000005B0: 43 48 52 45 43 3B 0D 0A  - 70 72 6F 63 65 64 75 72   CHREC;..procedur
000005C0: 65 20 77 72 69 74 65 64  - 73 70 28 62 3A 62 79 74   e writedsp(b:byt
000005D0: 65 29 3B 0D 0A 62 65 67  - 69 6E 0D 0A 61 73 6D 0D   e);..begin..asm.
000005E0: 0A 6D 6F 76 20 64 78 2C  - 24 32 32 43 3B 0D 0A 40   .mov dx,$22C;..@
000005F0: 77 61 72 74 65 6E 3A 0D  - 0A 69 6E 20 61 6C 2C 64   warten:..in al,d
00000600: 78 3B 0D 0A 74 65 73 74  - 20 61 6C 2C 24 38 30 3B   x;..test al,$80;
00000610: 0D 0A 6A 6E 65 20 40 77  - 61 72 74 65 6E 3B 0D 0A   ..jne @warten;..
00000620: 6D 6F 76 20 61 6C 2C 62  - 3B 0D 0A 6F 75 74 20 64   mov al,b;..out d
00000630: 78 2C 61 6C 3B 0D 0A 65  - 6E 64 3B 0D 0A 65 6E 64   x,al;..end;..end
00000640: 3B 0D 0A 66 75 6E 63 74  - 69 6F 6E 20 72 65 61 64   ;..function read
00000650: 64 73 70 3A 62 79 74 65  - 3B 0D 0A 76 61 72 20 74   dsp:byte;..var t
00000660: 3A 62 79 74 65 3B 0D 0A  - 62 65 67 69 6E 0D 0A 61   :byte;..begin..a
00000670: 73 6D 0D 0A 6D 6F 76 20  - 64 78 2C 24 32 32 45 3B   sm..mov dx,$22E;
00000680: 0D 0A 40 77 61 72 74 65  - 6E 3A 0D 0A 69 6E 20 61   ..@warten:..in a
00000690: 6C 2C 64 78 3B 0D 0A 74  - 65 73 74 20 61 6C 2C 24   l,dx;..test al,$
000006A0: 38 30 3B 0D 0A 6A 65 20  - 40 77 61 72 74 65 6E 3B   80;..je @warten;
000006B0: 0D 0A 73 75 62 20 64 6C  - 2C 34 3B 0D 0A 69 6E 20   ..sub dl,4;..in 
000006C0: 61 6C 2C 64 78 3B 0D 0A  - 6D 6F 76 20 74 2C 61 6C   al,dx;..mov t,al
000006D0: 3B 0D 0A 65 6E 64 3B 0D  - 0A 72 65 61 64 64 73 70   ;..end;..readdsp
000006E0: 3A 3D 74 3B 0D 0A 65 6E  - 64 3B 0D 0A 70 72 6F 63   :=t;..end;..proc
000006F0: 65 64 75 72 65 20 68 61  - 6E 64 6C 65 72 3B 69 6E   edure handler;in
00000700: 74 65 72 72 75 70 74 3B  - 0D 0A 62 65 67 69 6E 0D   terrupt;..begin.
00000710: 0A 61 73 6D 0D 0A 20 20  - 20 6D 6F 76 20 20 20 64   .asm..   mov   d
00000720: 78 2C 24 32 32 45 0D 0A  - 20 20 20 69 6E 20 20 20   x,$22E..   in   
00000730: 20 61 6C 2C 64 78 0D 0A  - 20 20 20 73 75 62 20 20    al,dx..   sub  
00000740: 20 64 78 2C 32 0D 0A 40  - 69 72 71 5F 62 65 72 65    dx,2..@irq_bere
00000750: 69 74 31 3A 0D 0A 20 20  - 20 69 6E 20 20 20 20 61   it1:..   in    a
00000760: 6C 2C 64 78 0D 0A 20 20  - 20 61 6E 64 20 20 20 61   l,dx..   and   a
00000770: 6C 2C 31 32 38 0D 0A 20  - 20 20 6A 6E 65 20 20 20   l,128..   jne   
00000780: 40 69 72 71 5F 62 65 72  - 65 69 74 31 0D 0A 20 20   @irq_bereit1..  
00000790: 20 6D 6F 76 20 20 20 61  - 6C 2C 24 31 34 0D 0A 20    mov   al,$14.. 
000007A0: 20 20 6F 75 74 20 20 20  - 64 78 2C 61 6C 0D 0A 40     out   dx,al..@
000007B0: 69 72 71 5F 62 65 72 65  - 69 74 32 3A 0D 0A 20 20   irq_bereit2:..  
000007C0: 20 69 6E 20 20 20 20 61  - 6C 2C 64 78 0D 0A 20 20    in    al,dx..  
000007D0: 20 61 6E 64 20 20 20 61  - 6C 2C 31 32 38 0D 0A 20    and   al,128.. 
000007E0: 20 20 6A 6E 65 20 20 20  - 40 69 72 71 5F 62 65 72     jne   @irq_ber
000007F0: 65 69 74 32 0D 0A 20 20  - 20 6D 6F 76 20 20 20 61   eit2..   mov   a
00000800: 78 2C 62 6C 32 0D 0A 20  - 20 20 6F 75 74 20 20 20   x,bl2..   out   
00000810: 64 78 2C 61 6C 0D 0A 40  - 69 72 71 5F 62 65 72 65   dx,al..@irq_bere
00000820: 69 74 33 3A 0D 0A 20 20  - 20 69 6E 20 20 20 20 61   it3:..   in    a
00000830: 6C 2C 64 78 0D 0A 20 20  - 20 61 6E 64 20 20 20 61   l,dx..   and   a
00000840: 6C 2C 31 32 38 0D 0A 20  - 20 20 6A 6E 65 20 20 20   l,128..   jne   
00000850: 40 69 72 71 5F 62 65 72  - 65 69 74 33 0D 0A 20 20   @irq_bereit3..  
00000860: 20 6D 6F 76 20 20 20 61  - 6C 2C 61 68 0D 0A 20 20    mov   al,ah..  
00000870: 20 6F 75 74 20 20 20 64  - 78 2C 61 6C 0D 0A 65 6E    out   dx,al..en
00000880: 64 3B 0D 0A 69 66 20 62  - 6C 6F 63 6B 20 74 68 65   d;..if block the
00000890: 6E 20 62 65 67 69 6E 0D  - 0A 62 6C 6F 63 6B 3A 3D   n begin..block:=
000008A0: 66 61 6C 73 65 3B 0D 0A  - 72 65 61 64 31 3A 3D 74   false;..read1:=t
000008B0: 72 75 65 3B 0D 0A 65 6E  - 64 20 65 6C 73 65 0D 0A   rue;..end else..
000008C0: 69 66 20 62 6C 6F 63 6B  - 3D 66 61 6C 73 65 20 74   if block=false t
000008D0: 68 65 6E 20 62 65 67 69  - 6E 0D 0A 62 6C 6F 63 6B   hen begin..block
000008E0: 3A 3D 74 72 75 65 3B 0D  - 0A 72 65 61 64 32 3A 3D   :=true;..read2:=
000008F0: 74 72 75 65 3B 0D 0A 65  - 6E 64 3B 0D 0A 69 66 20   true;..end;..if 
00000900: 67 72 6F 73 73 2D 32 2A  - 62 6C 6F 63 6B 67 72 3C   gross-2*blockgr<
00000910: 62 6C 6F 63 6B 67 72 20  - 74 68 65 6E 20 62 65 67   blockgr then beg
00000920: 69 6E 20 6C 61 73 74 3A  - 3D 74 72 75 65 3B 67 72   in last:=true;gr
00000930: 6F 73 73 3A 3D 66 69 6C  - 65 73 69 7A 65 28 66 29   oss:=filesize(f)
00000940: 3B 73 65 65 6B 28 66 2C  - 31 30 30 29 3B 65 6E 64   ;seek(f,100);end
00000950: 3B 0D 0A 70 6F 72 74 5B  - 24 32 30 5D 3A 3D 24 32   ;..port[$20]:=$2
00000960: 30 3B 0D 0A 65 6E 64 3B  - 0D 0A 70 72 6F 63 65 64   0;..end;..proced
00000970: 75 72 65 20 70 72 6F 67  - 72 61 6D 65 78 69 74 3B   ure programexit;
00000980: 66 61 72 3B 0D 0A 62 65  - 67 69 6E 0D 0A 7B 66 72   far;..begin..{fr
00000990: 65 65 6D 65 6D 28 62 6C  - 6B 31 2C 62 6C 6F 63 6B   eemem(blk1,block
000009A0: 67 72 29 3B 0D 0A 66 72  - 65 65 6D 65 6D 28 62 6C   gr);..freemem(bl
000009B0: 6B 32 2C 62 6C 6F 63 6B  - 67 72 29 3B 0D 0A 73 65   k2,blockgr);..se
000009C0: 74 69 6E 74 76 65 63 28  - 69 6E 74 65 72 2C 6F 6C   tintvec(inter,ol
000009D0: 64 69 6E 74 76 65 63 29  - 3B 7D 0D 0A 65 78 69 74   dintvec);}..exit
000009E0: 70 72 6F 63 3A 3D 6F 6C  - 64 65 78 69 74 3B 0D 0A   proc:=oldexit;..
000009F0: 77 72 69 74 65 6C 6E 28  - 27 44 65 61 6B 74 69 76   writeln('Deaktiv
00000A00: 69 65 72 65 20 4C 61 75  - 74 73 70 72 65 63 68 65   iere Lautspreche
00000A10: 72 20 2E 2E 2E 27 29 3B  - 0D 0A 77 72 69 74 65 64   r ...');..writed
00000A20: 73 70 28 24 44 30 29 3B  - 77 72 69 74 65 64 73 70   sp($D0);writedsp
00000A30: 28 24 44 33 29 3B 0D 0A  - 63 6C 6F 73 65 28 66 29   ($D3);..close(f)
00000A40: 3B 0D 0A 61 73 6D 0D 0A  - 20 20 20 6D 6F 76 20 20   ;..asm..   mov  
00000A50: 20 61 78 2C 5B 57 4F 52  - 44 20 50 54 52 20 6F 6C    ax,[WORD PTR ol
00000A60: 64 69 6E 74 76 65 63 2B  - 30 5D 0D 0A 20 20 20 6D   dintvec+0]..   m
00000A70: 6F 76 20 20 20 64 78 2C  - 5B 57 4F 52 44 20 50 54   ov   dx,[WORD PT
00000A80: 52 20 6F 6C 64 69 6E 74  - 76 65 63 2B 32 5D 0D 0A   R oldintvec+2]..
00000A90: 20 20 20 78 6F 72 20 20  - 20 64 69 2C 64 69 0D 0A      xor   di,di..
00000AA0: 20 20 20 6D 6F 76 20 20  - 20 65 73 2C 64 69 0D 0A      mov   es,di..
00000AB0: 20 20 20 6D 6F 76 20 20  - 20 64 69 2C 31 0D 0A 20      mov   di,1.. 
00000AC0: 20 20 73 68 6C 20 20 20  - 64 69 2C 32 0D 0A 20 20     shl   di,2..  
00000AD0: 20 61 64 64 20 20 20 64  - 69 2C 32 30 68 0D 0A 20    add   di,20h.. 
00000AE0: 20 20 6D 6F 76 20 20 20  - 57 4F 52 44 20 50 54 52     mov   WORD PTR
00000AF0: 20 65 73 3A 5B 64 69 2B  - 30 5D 2C 61 78 0D 0A 20    es:[di+0],ax.. 
00000B00: 20 20 6D 6F 76 20 20 20  - 57 4F 52 44 20 50 54 52     mov   WORD PTR
00000B10: 20 65 73 3A 5B 64 69 2B  - 32 5D 2C 64 78 0D 0A 20    es:[di+2],dx.. 
00000B20: 20 20 6D 6F 76 20 20 20  - 61 78 2C 70 6E 0D 0A 20     mov   ax,pn.. 
00000B30: 20 20 6D 6F 76 20 20 20  - 65 73 2C 70 6E 0D 0A 20     mov   es,pn.. 
00000B40: 20 20 6D 6F 76 20 20 20  - 61 68 2C 34 39 68 0D 0A     mov   ah,49h..
00000B50: 20 20 20 69 6E 74 20 20  - 20 32 31 68 0D 0A 65 6E      int   21h..en
00000B60: 64 3B 0D 0A 70 6F 72 74  - 5B 64 6D 61 5F 63 6C 65   d;..port[dma_cle
00000B70: 61 72 5F 6D 61 73 6B 5F  - 72 65 67 5B 64 6D 61 5D   ar_mask_reg[dma]
00000B80: 5D 3A 3D 30 3B 0D 0A 70  - 6F 72 74 5B 24 30 45 5D   ]:=0;..port[$0E]
00000B90: 3A 3D 31 3B 0D 0A 70 6F  - 72 74 5B 24 32 30 5D 3A   :=1;..port[$20]:
00000BA0: 3D 24 32 30 3B 0D 0A 65  - 6E 64 3B 0D 0A 70 72 6F   =$20;..end;..pro
00000BB0: 63 65 64 75 72 65 20 69  - 6E 69 74 64 6D 61 64 73   cedure initdmads
00000BC0: 70 28 62 75 66 3A 70 6F  - 69 6E 74 65 72 3B 73 69   p(buf:pointer;si
00000BD0: 7A 65 3A 77 6F 72 64 29  - 3B 0D 0A 62 65 67 69 6E   ze:word);..begin
00000BE0: 0D 0A 70 68 79 73 70 6F  - 73 3A 3D 31 36 2A 6C 6F   ..physpos:=16*lo
00000BF0: 6E 67 69 6E 74 28 70 74  - 28 62 75 66 29 2E 73 65   ngint(pt(buf).se
00000C00: 67 6D 29 2B 70 74 28 62  - 75 66 29 2E 6F 66 73 3B   gm)+pt(buf).ofs;
00000C10: 0D 0A 70 6E 3A 3D 70 74  - 28 70 68 79 73 70 6F 73   ..pn:=pt(physpos
00000C20: 29 2E 73 65 67 6D 3B 0D  - 0A 6F 66 66 73 65 3A 3D   ).segm;..offse:=
00000C30: 70 74 28 70 68 79 73 70  - 6F 73 29 2E 6F 66 73 3B   pt(physpos).ofs;
00000C40: 0D 0A 70 6F 72 74 5B 24  - 30 45 5D 3A 3D 31 3B 0D   ..port[$0E]:=1;.
00000C50: 0A 70 6F 72 74 5B 64 6D  - 61 77 72 5F 73 69 6E 67   .port[dmawr_sing
00000C60: 6C 65 5F 6D 61 73 6B 5F  - 52 65 67 5B 64 6D 61 5D   le_mask_Reg[dma]
00000C70: 5D 3A 3D 34 2B 64 6D 61  - 3B 0D 0A 70 6F 72 74 5B   ]:=4+dma;..port[
00000C80: 64 6D 61 77 72 5F 6D 6F  - 64 65 5F 72 65 67 5B 64   dmawr_mode_reg[d
00000C90: 6D 61 5D 5D 3A 3D 64 6D  - 61 2B 24 35 38 3B 0D 0A   ma]]:=dma+$58;..
00000CA0: 70 6F 72 74 5B 64 6D 61  - 5F 61 64 72 65 73 73 5B   port[dma_adress[
00000CB0: 64 6D 61 5D 5D 3A 3D 6C  - 6F 28 6F 66 66 73 65 29   dma]]:=lo(offse)
00000CC0: 3B 0D 0A 70 6F 72 74 5B  - 64 6D 61 5F 61 64 72 65   ;..port[dma_adre
00000CD0: 73 73 5B 64 6D 61 5D 5D  - 3A 3D 68 69 28 6F 66 66   ss[dma]]:=hi(off
00000CE0: 73 65 29 3B 0D 0A 70 6F  - 72 74 5B 44 4D 41 5F 6C   se);..port[DMA_l
00000CF0: 6F 77 65 72 5F 50 61 67  - 65 5B 64 6D 61 5D 5D 3A   ower_Page[dma]]:
00000D00: 3D 6C 6F 28 70 6E 29 3B  - 0D 0A 70 6F 72 74 5B 44   =lo(pn);..port[D
00000D10: 4D 41 5F 68 69 67 68 65  - 72 5F 50 61 67 65 5B 64   MA_higher_Page[d
00000D20: 6D 61 5D 5D 3A 3D 68 69  - 28 70 6E 29 3B 0D 0A 70   ma]]:=hi(pn);..p
00000D30: 6F 72 74 5B 64 6D 61 63  - 6C 65 61 72 5F 66 6C 69   ort[dmaclear_fli
00000D40: 70 66 6C 6F 70 5B 64 6D  - 61 5D 5D 3A 3D 30 3B 0D   pflop[dma]]:=0;.
00000D50: 0A 70 6F 72 74 5B 64 6D  - 61 5F 63 6F 75 6E 74 5B   .port[dma_count[
00000D60: 64 6D 61 5D 5D 3A 3D 6C  - 6F 28 73 69 7A 65 2A 32   dma]]:=lo(size*2
00000D70: 2D 31 29 3B 0D 0A 70 6F  - 72 74 5B 64 6D 61 5F 63   -1);..port[dma_c
00000D80: 6F 75 6E 74 5B 64 6D 61  - 5D 5D 3A 3D 68 69 28 73   ount[dma]]:=hi(s
00000D90: 69 7A 65 2A 32 2D 31 29  - 3B 0D 0A 77 72 69 74 65   ize*2-1);..write
00000DA0: 6C 6E 28 27 41 6B 74 69  - 76 69 65 72 65 20 4C 61   ln('Aktiviere La
00000DB0: 75 74 73 70 72 65 63 68  - 65 72 27 29 3B 0D 0A 77   utsprecher');..w
00000DC0: 72 69 74 65 64 73 70 28  - 24 64 31 29 3B 0D 0A 77   ritedsp($d1);..w
00000DD0: 72 69 74 65 64 73 70 28  - 24 34 30 29 3B 0D 0A 77   ritedsp($40);..w
00000DE0: 72 69 74 65 64 73 70 28  - 32 35 36 2D 31 30 30 30   ritedsp(256-1000
00000DF0: 30 30 30 20 64 69 76 20  - 66 72 65 71 75 65 6E 7A   000 div frequenz
00000E00: 29 3B 0D 0A 77 72 69 74  - 65 64 73 70 28 24 31 34   );..writedsp($14
00000E10: 29 3B 0D 0A 77 72 69 74  - 65 64 73 70 28 6C 6F 28   );..writedsp(lo(
00000E20: 73 69 7A 65 2D 31 29 29  - 3B 0D 0A 77 72 69 74 65   size-1));..write
00000E30: 64 73 70 28 68 69 28 73  - 69 7A 65 2D 31 29 29 3B   dsp(hi(size-1));
00000E40: 0D 0A 61 73 6D 0D 0A 63  - 6C 69 0D 0A 6D 6F 76 20   ..asm..cli..mov 
00000E50: 64 69 2C 69 6E 74 65 72  - 0D 0A 6D 6F 76 20 63 78   di,inter..mov cx
00000E60: 2C 64 69 0D 0A 69 6E 20  - 61 6C 2C 24 32 31 0D 0A   ,di..in al,$21..
00000E70: 6D 6F 76 20 62 6C 2C 31  - 0D 0A 73 68 6C 20 62 6C   mov bl,1..shl bl
00000E80: 2C 63 6C 0D 0A 6E 6F 74  - 20 62 6C 0D 0A 61 6E 64   ,cl..not bl..and
00000E90: 20 61 6C 2C 62 6C 0D 0A  - 6F 75 74 20 24 32 31 2C    al,bl..out $21,
00000EA0: 61 6C 0D 0A 6D 6F 76 20  - 61 78 2C 6F 66 66 73 65   al..mov ax,offse
00000EB0: 74 20 68 61 6E 64 6C 65  - 72 0D 0A 78 6F 72 20 64   t handler..xor d
00000EC0: 78 2C 64 78 0D 0A 6D 6F  - 76 20 65 73 2C 64 78 0D   x,dx..mov es,dx.
00000ED0: 0A 6D 6F 76 20 64 78 2C  - 63 73 0D 0A 73 68 6C 20   .mov dx,cs..shl 
00000EE0: 64 69 2C 32 0D 0A 61 64  - 64 20 64 69 2C 24 32 30   di,2..add di,$20
00000EF0: 0D 0A 78 63 68 67 20 61  - 78 2C 77 6F 72 64 20 70   ..xchg ax,word p
00000F00: 74 72 20 65 73 3A 5B 64  - 69 2B 30 5D 0D 0A 78 63   tr es:[di+0]..xc
00000F10: 68 67 20 64 78 2C 77 6F  - 72 64 20 70 74 72 20 65   hg dx,word ptr e
00000F20: 73 3A 5B 64 69 2B 32 5D  - 0D 0A 6D 6F 76 20 5B 77   s:[di+2]..mov [w
00000F30: 6F 72 64 20 70 74 72 20  - 6F 6C 64 69 6E 74 76 65   ord ptr oldintve
00000F40: 63 2B 30 5D 2C 61 78 0D  - 0A 6D 6F 76 20 5B 77 6F   c+0],ax..mov [wo
00000F50: 72 64 20 70 74 72 20 6F  - 6C 64 69 6E 74 76 65 63   rd ptr oldintvec
00000F60: 2B 32 5D 2C 64 78 0D 0A  - 6D 6F 76 20 64 78 2C 24   +2],dx..mov dx,$
00000F70: 32 32 43 0D 0A 73 75 62  - 20 64 78 2C 38 0D 0A 6D   22C..sub dx,8..m
00000F80: 6F 76 20 61 6C 2C 24 30  - 65 0D 0A 6F 75 74 20 64   ov al,$0e..out d
00000F90: 78 2C 61 6C 0D 0A 69 6E  - 63 20 64 78 0D 0A 69 6E   x,al..inc dx..in
00000FA0: 20 61 6C 2C 64 78 0D 0A  - 6F 72 20 61 6C 2C 32 0D    al,dx..or al,2.
00000FB0: 0A 6F 75 74 20 64 78 2C  - 61 6C 0D 0A 73 74 69 0D   .out dx,al..sti.
00000FC0: 0A 65 6E 64 3B 0D 0A 70  - 6F 72 74 5B 64 6D 61 77   .end;..port[dmaw
00000FD0: 72 5F 73 69 6E 67 6C 65  - 5F 6D 61 73 6B 5F 52 65   r_single_mask_Re
00000FE0: 67 5B 64 6D 61 5D 5D 3A  - 3D 64 6D 61 3B 0D 0A 65   g[dma]]:=dma;..e
00000FF0: 6E 64 3B 0D 0A 62 65 67  - 69 6E 0D 0A 63 6C 72 73   nd;..begin..clrs
00001000: 63 72 3B 0D 0A 66 72 65  - 71 75 65 6E 7A 3A 3D 32   cr;..frequenz:=2
00001010: 32 30 30 30 3B 0D 0A 62  - 6C 6F 63 6B 3A 3D 74 72   2000;..block:=tr
00001020: 75 65 3B 0D 0A 62 6C 6F  - 63 6B 67 72 3A 3D 32 30   ue;..blockgr:=20
00001030: 34 38 3B 0D 0A 62 6C 32  - 3A 3D 62 6C 6F 63 6B 67   48;..bl2:=blockg
00001040: 72 2D 31 3B 0D 0A 61 73  - 73 69 67 6E 28 66 2C 27   r-1;..assign(f,'
